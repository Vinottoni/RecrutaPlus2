@model FuncionarioSearch

@{
    Layout = "_Layout";
    ViewData["Title"] = "Dashboard - RecrutaPlus";
}

<div class="content-pages  text-yellowy">
    <div class="container">
        <div class="page-titles">
            <h2 class="text-title-nero">
                Geral Information 
            </h2>
        </div>
        <div class="section-block">
            <h5 class="section-title"> Dashboard</h5>
            <div class="metric-row d-flex flex-wrap justify-content-between">
                <div class="col-12 col-sm-12 col-md-6 col-lg-6 col-xl-2">
                    <div class="card-metric-custom">
                        <div>
                                <p class="metric-value h1">
                                <sub><i class="fa-solid fa-chart-line text-white-custom"></i></sub> <span class="value">@Html.DisplayFor(model => model.DashboardViewModel.TotalFuncionarios)</span>
                                </p>
                            <label class="metric-label text-white-custom">Total de Funcionarios</label>
                        </div>
                    </div>
                </div>

                <div class="col-12 col-sm-12 col-md-6 col-lg-6 col-xl-2">
                    <div class="card-metric-custom">
                        <div>
                                <p class="metric-value h1">
                                <sub><i class="fa-solid fa-chart-line text-white-custom"></i></sub> <span class="value">@Html.DisplayFor(model => model.DashboardViewModel.FuncionariosAtivos)</span>
                                </p>
                            <label class="metric-label text-white-custom">Funcionarios Ativos</label>
                        </div>
                    </div>
                </div>

                <div class="col-12 col-sm-12 col-md-6 col-lg-6 col-xl-2">
                    <div class="card-metric-custom">
                        <div>
                                <p class="metric-value h1">
                                <sub><i class="fa-solid fa-chart-line text-white-custom"></i></sub> <span class="value">@Html.DisplayFor(model => model.DashboardViewModel.FuncionariosDesativados)</span>
                                </p>
                            <label class="metric-label text-white-custom">Funcionarios Desativados</label>
                        </div>
                    </div>
                </div>

                <div class="col-12 col-sm-12 col-md-6 col-lg-6 col-xl-2">
                    <div class="card-metric-custom">
                        <div>
                                <p class="metric-value h1">
                                <sub><i class="fa-solid fa-chart-line text-white-custom"></i></sub> <span class="value">@Html.DisplayFor(model => model.DashboardViewModel.FuncionariosRecentes)</span>
                                </p>
                            <label class="metric-label text-white-custom">Funcionarios Recentes</label>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <hr class="hr-color" />
       
        <div class="accordion" id="accordionPanelsStayOpenExample">
            <div class="accordion-item collapse-color">
                <h2 class="accordion-header" id="panelsStayOpen-headingOne">
                    <button class="accordion-button-custom" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true" aria-controls="panelsStayOpen-collapseOne">
                        <strong>Funcionários Recentes</strong>
                    </button>
                </h2>
                <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show" aria-labelledby="panelsStayOpen-headingOne">
                    <div class="accordion-body">
                        <div class="table-responsive">

                            <table class="table datatables-table table-borderless" style="width:100%">
                                <thead class="border-tb-dashboard table-header-custom">
                                    <tr class="text-yellowy">
                                        <th>
                                            @Html.DisplayNameFor(model => model.Itens.FirstOrDefault().Nome)
                                        </th>
                                        <th>
                                            @Html.DisplayNameFor(model => model.Itens.FirstOrDefault().Email)
                                        </th>
                                    </tr>
                                </thead>
                                <tbody class="table-body-color">
                                    @foreach (FuncionarioViewModel item in Model.Itens.Take(3))
                                    {
                                        <tr class="text-white-custom">
                                            <td class="text-left align-middle">
                                                @Html.DisplayFor(modelItem => item.Nome)
                                            </td>
                                            <td class="text-left align-middle">
                                                @Html.DisplayFor(modelItem => item.Email)
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-sm-12 col-md-12">&nbsp;</div>

        <div class="card-custom">
            <div class="card-body card-body-custom d-flex card-background justify-content-center">
                <div class="col-sm-12 col-md-6 justify-content-center d-flex">
                    <canvas id="myChart" class="size-canva"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

@{
    var funcionariosTotais = ViewBag.FuncionariosTotais;
    var funcionariosAtivos = ViewBag.FuncionariosAtivos;
    var funcionariosDesativados = ViewBag.FuncionariosDesativados;

    var TotalSerializados = Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(funcionariosTotais));
    var ativosSerializados = Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(funcionariosAtivos));
    var desativadosSerializados = Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(funcionariosDesativados));
}

@section Scripts{
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>

        var funcionariosTotais = @funcionariosTotais;
        var funcionariosAtivos = @ativosSerializados;
        var funcionariosDesativados = @desativadosSerializados;

        $(document)
        .ready(function () {
                const ctx = document.getElementById('myChart');
                const myChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Ativos', 'Desativados'],
                        datasets: [{
                            label: [''],
                            data: [funcionariosAtivos, funcionariosDesativados],
                            backgroundColor: [
                                'rgba(167, 215, 41, 1)',
                                'rgba(255, 174, 174, 1)',
                            ],
                            borderColor: [
                                'rgba(167, 215, 4, 1)',
                                'rgba(255, 174, 174, 1)',
                            ],
                            borderWidth: 1
                        }]
                    },
                });
                const grafctx = document.getElementById('grafBar');
        })
        
    </script>
}

